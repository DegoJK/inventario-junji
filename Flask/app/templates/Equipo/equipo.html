{% extends "layout.html" %}
{% block body %}
{% from 'funciones_macro.html' import paginacion, select, select_modelo, select_tipo%}

<div class="row">

    <div>
        <!-- Exportar -->
        <div class="card card-body" id="formularioExcel" style="display: none;">
            <h2>Seleccione que hojas quiere</h2>
            <form action="/test_excel_form" method="POST" class="mi-formulario">
                <div style="display:grid;">
                    <div style="padding: 30px;">
                        <input name="todo_check" type="radio" id="todo_check" onclick="todoCheck()" />
                        <label for="todo_check">Todo en una pagina</label>
                    </div>
                    <div id="checkbox_container">
                        <div>
                            <input onclick="check_all()" type="checkbox" id="checkall" />
                            <label for="checkall">Tickear todo</label>
                        </div>
                        <div>
                            <input onclick="sheetCheck()" type="checkbox" id="AIO_check" name="AIO_check" />
                            <label for="AIO_check">AIO</label>
                        </div>
                        <div>
                            <input onclick="sheetCheck()" type="checkbox" id="Notebooks" name="Notebooks" />
                            <label for="Notebooks">Notebooks</label>
                        </div>
                        <div>
                            <input onclick="sheetCheck()" type="checkbox" id="impresoras_check"
                                name="impresoras_check" />
                            <label for="impresoras_check">Impresoras</label>
                        </div>
                        <div>
                            <input onclick="sheetCheck()" type="checkbox" id="bam_check" name="bam_check" />
                            <label for="bam_check">Bam</label>
                        </div>
                        <div>
                            <input onclick="sheetCheck()" type="checkbox" id="proyectores_check"
                                name="proyectores_check" />
                            <label for="proyectores_check">Proyectores</label>
                        </div>
                        <div>

                            <input onclick="sheetCheck()" type="checkbox" id="telefonos_check" name="telefonos_check" />
                            <label for="telefonos_check">Teléfonos</label>
                        </div>
                        <div>
                            <input onclick="sheetCheck()" type="checkbox" id="HDD_check" name="HDD_check" />

                            <label for="HDD_check">Discos Duros Externos</label>
                        </div>
                        <div>
                            <input onclick="sheetCheck()" type="checkbox" id="tablets_check" name="tablets_check" />
                            <label for="tablets_check">Tablets</label>
                        </div>
                        <div>

                            <input onclick="sheetCheck()" type="checkbox" id="otros_check" name="otros_check" />
                            <label for="otros_check">Otros</label>
                        </div>
                    </div>
                    <button class="agregar-button">Exportar</button>
                </div>
            </form>
        </div>
        <div class="card card-body" id="importar_excel" style="display: none;">
            {#aqui formulario para importar datos#}
            <h2>Importar Equipos o Unidades</h2>
            <div class="card card-body" id="formulario" style="display: block;">
                <form action="/equipo/importar_excel" method="POST" class="mi-formulario" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="file">Añadir Excel e importar Equipos</label>
                        <input type="file" name="file" />
                        {# se nesesita una forma eficiente de añadir el equipo#}
                        <button class="agregar-button"> Agregar</button>
                    </div>
                </form>
            </div>
            <div class="card card-body" id="formulario" style="display: block;">
                <form action="/equipo/importar_excel/unidad" method="POST" class="mi-formulario"
                    enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="file">Añadir Excel e importar Unidad</label>
                        <input type="file" name="file" />
                        {# se nesesita una forma eficiente de añadir el equipo#}
                        <button class="agregar-button"> Agregar</button>
                    </div>
                </form>
            </div>
        </div>

        <div>
            <!-- Título -->
            <div class="text-center mb-4">
                <h2 class="mb-0">Equipos</h2>
            </div>

            <!-- Toolbar con Título, Buscador y Botones -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <!-- Sección Izquierda -->
                <div class="d-flex gap-2">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEquipoModal">
                        Agregar
                    </button>
                    <button class="btn btn-primary" onclick="showDiv('importar_excel', ['formularioExcel'])">
                        <img src="{{ url_for('static', filename='img/icons8-ms-excel.svg') }}" alt="Importar Excel"
                            width="20" height="20" class="me-1">
                        <span>Importar</span>
                    </button>
                    <button class="btn btn-primary" onclick="showDiv('formularioExcel', ['importar_excel'])">
                        <img src="{{ url_for('static', filename='img/icons8-ms-excel.svg') }}" alt="Exportar Excel"
                            width="20" height="20" class="me-1">
                        <span>Exportar</span>
                    </button>
                </div>

                <!-- Título y Buscador -->
                <div class="d-flex flex-grow-1 justify-content-center align-items-center">
                    <div>
                        <div>
                            <form action="/consulta_equipo" method="POST">
                                <input name="palabra" type="text" class="search-box" placeholder="Buscar equipos"
                                    id="buscador" onkeyup="busqueda('myTableBody')" />
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Sección Derecha -->
                <div class="d-flex gap-2">
                    <button class="btn btn-success " id="assign-button" data-bs-toggle="tooltip"
                        data-bs-title="Asignar">
                        <i class="bi bi-person-fill-add"></i>
                    </button>
                    <button class="btn btn-warning " id="return-button" data-bs-toggle="tooltip"
                        data-bs-title="Devolver">
                        <i class="fa-solid fa-arrow-rotate-left" style="color: #ffffff;"></i>
                    </button>
                    <
                    <button class="btn btn-secondary" id="incidencia-button" data-bs-toggle="modal"
                        data-bs-target="#add_incidencia">
                        <i class="bi bi-incognito"></i>
                    </button>


                    <button class="btn btn-danger" id="delete-selected-button" data-bs-toggle="tooltip"
                        data-bs-title="Eliminar">
                        <i class="bi bi-trash-fill"></i>
                    </button>


                </div>
            </div>

            <!-- Tabla -->
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead class="col-md-12">
                        <tr>
                            <th class="checkbox-column" onclick="toggleSelectAll()">Todo</th>
                            <th onclick="sortTable(1,this)" class="sortable-column">C. Inv</th>
                            <th onclick="sortTable(2,this)" class="sortable-column">N° Serie</th>
                            <th onclick="sortTable(3,this)" class="sortable-column">Funcionario</th>
                            <th onclick="sortTable(4,this)" class="sortable-column">C. Prov</th>
                            <th onclick="sortTable(5,this)" class="sortable-column">Unidad</th>
                            <th onclick="sortTable(6,this)" class="sortable-column">Tipo equipo</th>
                            <th onclick="sortTable(7,this)" class="sortable-column">Modelo</th>
                            <th>Detalles</th>
                            <th>Editar</th>
                        </tr>
                    </thead>
                    <tbody id="myTableBody">
                        {% if equipo %}
                        {% for equi in equipo %}
                        <tr data-id="{{ equi.idEquipo }}">
                            <td class="checkbox-column">
                                <input type="checkbox" class="checkbox-table row-checkbox">
                            </td>
                            <td class="toCheck">{{equi.Cod_inventarioEquipo}}</td>
                            <td class="toCheck">{{equi.Num_serieEquipo}}</td>
                            {% if equi.nombreFuncionario == '' %}
                            <td class="toCheck">{{equi.nombreEstado_equipo}}</td>
                            {% else %}
                            <td class="toCheck">{{equi.nombreFuncionario}}</td>
                            {% endif %}
                            <td class="toCheck">{{equi.codigoproveedor_equipo if equi.codigoproveedor_equipo else '-'}}
                            </td>
                            <td class="toCheck">{{equi.nombreUnidad}}</td>
                            <td class="toCheck">{{equi.nombreTipo_equipo}}</td>
                            <td class="toCheck">{{equi.nombreModeloequipo}}</td>
                            <td><a href="/equipo_detalles/{{equi.idEquipo}}" class="btn button-info"><i
                                        class="bi bi-eye-fill"></i></a></td>
                            <td>
                                <button class="btn btn-warning edit-equipo-btn" data-bs-toggle="modal"
                                    data-bs-target="#editEquipoModal" data-id="{{ equi.idEquipo }}"
                                    data-codigo="{{ equi.Cod_inventarioEquipo }}"
                                    data-serie="{{ equi.Num_serieEquipo }}"
                                    data-observacion="{{ equi.ObservacionEquipo }}" data-unidad="{{ equi.idUnidad }}"
                                    data-orden="{{ equi.idOrden_compra }}" data-marca="{{ equi.idMarca_Equipo }}"
                                    data-tipo="{{ equi.idTipo_equipo }}" data-modelo="{{ equi.idModelo_equipo }}"
                                    data-proveedor="{{ equi.codigoproveedor_equipo}}" data-mac="{{ equi.macEquipo }}"
                                    data-imei="{{ equi.imeiEquipo }}" data-numero="{{ equi.numerotelefonicoEquipo }}"
                                    data-estado="{{ equi.nombreEstado_equipo }}">
                                    <i class="bi bi-pencil-square"></i>
                                </button>

                            </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="10" class="text-center">No hay datos disponibles.</td>
                        </tr>
                        {% endif %}
                    </tfoot>
                </table>
            </div>
        </div>



        <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

        <script src="{{ url_for('static', filename='js/Equipo/equipo.js') }}"></script>

        <!-- Bootstrap JS Bundle -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>



        {% include 'Equipo/equipo.modals.html'%}
        {{ paginacion("equipo", page, lastpage) }}
        {% endblock %}
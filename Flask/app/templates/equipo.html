{% extends "layout.html" %}
{% block body %}
{% from 'funciones_macro.html' import paginacion, select, select_modelo, select_tipo%}

<div class="row">

    <div class="col-md-5">
        <!-- Esta seccion se utiliza para mostrar los errores a traves de flash siempre y cuando existan errores -->
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}

        <div class="custom-alert" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
        <!-- Se termina la seccion de errores -->

        <!-- Modal para el formulario -->
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#formModal">
            Agregar
        </button>
        

<h2>Equipo</h2>
<button class="nav-button" onclick="showDiv('formularioExcel', ['importar_excel'])">Exportar a Excel</button>
<button class="nav-button" onclick="showDiv('importar_excel', ['formularioExcel'])">Importar a Excel</button>
<div class="card card-body" id="formularioExcel" style="display: none;">
    <h2>Seleccione que hojas quiere</h2>
    <form action="/test_excel_form" method="POST" class="mi-formulario">
        <div style="display:grid;">
            <div style="padding: 30px;">
                <input name="todo_check" type="radio" id="todo_check" onclick="todoCheck()" />
                <label for="todo_check">Todo en una pagina</label>
            </div>
            <div id="checkbox_container">
                <div>
                    <input onclick="check_all()" type="checkbox" id="checkall" />
                    <label for="checkall">Tickear todo</label>
                </div>
                <div>
                    <input onclick="sheetCheck()" type="checkbox" id="AIO_check" name="AIO_check" />
                    <label for="AIO_check">AIO</label>
                </div>
                <div>
                    <input onclick="sheetCheck()" type="checkbox" id="Notebooks" name="Notebooks" />
                    <label for="Notebooks">Notebooks</label>
                </div>
                <div>
                    <input onclick="sheetCheck()" type="checkbox" id="impresoras_check" name="impresoras_check" />
                    <label for="impresoras_check">Impresoras</label>
                </div>
                <div>
                    <input onclick="sheetCheck()" type="checkbox" id="bam_check" name="bam_check" />
                    <label for="bam_check">Bam</label>
                </div>
                <div>
                    <input onclick="sheetCheck()" type="checkbox" id="proyectores_check" name="proyectores_check" />
                    <label for="proyectores_check">Proyectores</label>
                </div>
                <div>

                    <input onclick="sheetCheck()" type="checkbox" id="telefonos_check" name="telefonos_check" />
                    <label for="telefonos_check">Teléfonos</label>
                </div>
                <div>
                    <input onclick="sheetCheck()" type="checkbox" id="HDD_check" name="HDD_check" />

                    <label for="HDD_check">Discos Duros Externos</label>
                </div>
                <div>
                    <input onclick="sheetCheck()" type="checkbox" id="tablets_check" name="tablets_check" />
                    <label for="tablets_check">Tablets</label>
                </div>
                <div>

                    <input onclick="sheetCheck()" type="checkbox" id="otros_check" name="otros_check" />
                    <label for="otros_check">Otros</label>
                </div>
            </div>
            <button class="agregar-button">Exportar</button>
        </div>
    </form>
</div>
<div class="card card-body" id="importar_excel" style="display: none;">
    {#aqui formulario para importar datos#}
<h2>Importar Equipos o Unidades</h2>
    <div class="card card-body" id="formulario" style="display: block;">
        <form action="/equipo/importar_excel" method="POST" class="mi-formulario" enctype="multipart/form-data">
            <div class="form-group">
                <label for="file">Añadir Excel e importar Equipos</label>
                <input type="file" name="file" />
                {# se nesesita una forma eficiente de añadir el equipo#}
                <button class="agregar-button"> Agregar</button>
            </div>
        </form>
    </div>
    <div class="card card-body" id="formulario" style="display: block;">
        <form action="/equipo/importar_excel/unidad" method="POST" class="mi-formulario" enctype="multipart/form-data">
            <div class="form-group">
                <label for="file">Añadir Excel e importar Unidad</label>
                <input type="file" name="file" />
                {# se nesesita una forma eficiente de añadir el equipo#}
                <button class="agregar-button"> Agregar</button>
            </div>
        </form>
    </div>
</div>

<br />
<div style="margin: auto; padding: 0px; width:0px; background:black; text-align:center">
    <div style="display:flex;">
        <form action="/consulta_equipo" method="POST">
            <input name="palabra" type="text" class="search-box" placeholder="Buscar Equipos" id="buscador"
                onkeyup="busqueda('myTableBody')" />
            {#<button class="nav-button" type="submit">Buscar</button>#}
        </form>
    </div>

</div>
<div style="overflow-x:auto;">
    <table id="posts">
        <thead>
            <tr>
                <td onclick="sortTable(0)">Código Inventario</td>
                <td onclick="sortTable(1)">N° Serie</td>
                <td onclick="sortTable(2)">Funcionario</td>
                <td onclick="sortTable(3)">Código Proveedor</td>
                <td onclick="sortTable(4)">Unidad</td>
                <td onclick="sortTable(5)">Tipo equipo</td>
                <td onclick="sortTable(6)">Modelo</td>
                <td>Acciones</td>
            </tr>
        </thead>
        <tbody id="myTableBody">
            <!-- Se inicia iteracion for para mostrar todos los proveedores -->
            {% for equi in equipo %}
            <tr>
                <td class="toCheck">{{equi.Cod_inventarioEquipo}}</td>
                <td class="toCheck">{{equi.Num_serieEquipo}}</td>
                {% if equi.nombreFuncionario == '' %}
                <td class="toCheck">{{equi.nombreEstado_equipo}}</td>
                {% else %}
                <td class="toCheck">{{equi.nombreFuncionario}}</td>
                {% endif %}
                <td class="toCheck">{{equi.codigoproveedor_equipo}}</td>
                <td class="toCheck">{{equi.nombreUnidad}}</td>
                <td class="toCheck">{{equi.nombreTipo_equipo}}</td>
                <td class="toCheck">{{equi.nombreModeloequipo}}</td>
                <td>
                    {#clase para tener un boton que despliega los otros botones #}
                    <div class="dropdown">
                        <button class="options-button">Opciones</button>
                        <div class="dropdown-options">
                            <a href="/edit_equipo/{{equi.idEquipo}}" class="success-button"
                                style="width: 90%;">Editar</a>
                            <a href="/delete_equipo/{{equi.idEquipo}}" class="delete-button"
                                style="width: 90%;">Eliminar</a>
                            <a href="/equipo_detalles/{{equi.idEquipo}}" class="info-button"
                                style="width: 90%;">Detalles</a>
                            <a href="/incidencia/form/{{equi.idEquipo}}" class="agregar-button"
                                style="width: 90%;">Incidencia</a>
                            {% if equi.nombreEstado_equipo == "SIN ASIGNAR" %}
                            <a href="/add_asignacion/{{equi.idEquipo}}" class="agregar-button"
                                style="width: 90%;">Asignar</a>
                            {% else %}
                                {% if equi.nombreEstado_equipo == "EN USO" %}
                                    <a href="/asignacion/devolver_uno/{{equi.idEquipo}}" class="agregar-button"
                                        style="width: 90%;">Devolver</a>
                                {% endif%}
                            {% endif %}


                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>


    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script src="../static/js/main.js"></script>
    
    {{ paginacion("equipo", page, lastpage) }}
    {% endblock %}
